[include shell_command.cfg]
[include mainsail.cfg]
[include EBBCan.cfg]
[include NozzleClean.cfg]
[include Macro.cfg]
[include eddy.cfg]
#[include adxl.cfg ]
[exclude_object]
[include macros2.cfg]
[include macros3.cfg]


[mcu]
canbus_UUID: 883625e8021b

[stepper_x]
step_pin: PF13
dir_pin: !PF12
enable_pin: !PF14
microsteps: 256
rotation_distance: 40
endstop_pin: !PG6
position_endstop: -50
position_max: 299
homing_speed: 100
position_min: -59


# Driver1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
microsteps: 256
rotation_distance: 40
endstop_pin: !PG9
position_endstop: -11
position_max: 240
homing_speed: 100
position_min: -27

# Driver2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
microsteps: 256
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0.5
position_max: 260
homing_speed: 100
gear_ratio: 80:16
full_steps_per_rotation: 200 #200 for 1.8 degree, 400 for 0.9 degree
position_min: -20

# Driver3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
microsteps: 256
rotation_distance: 40
gear_ratio: 80:16
full_steps_per_rotation: 200 #200 for 1.8 degree, 400 for 0.9 degree
#endstop_pin: PG11

# Driver4
[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan:PD1
enable_pin: !EBBCan:PD2
microsteps: 256
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan:PB13 # HE0
sensor_pin:  EBBCan:PA3 # T0
sensor_type: EPCOS 100K B57560G104F
control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
min_temp: 0
max_temp: 300

#[filament_switch_sensor material_0]
#switch_pin: PG12

[heater_bed]
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF3 #TB
control: pid
#tuned for stock hardware with 50 degree Celsius target
#pid_Kp: 46.530
#pid_Ki: 11.931
#pid_Kd: 45.36
min_temp: 0
max_temp: 130

#[fan]
#pin: PA8
[input_shaper]
shaper_freq_x: 44.8
shaper_type_x: mzv
shaper_freq_y: 31.6
shaper_type_y: mzv

[printer]
kinematics: cartesian
max_velocity: 3000
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[z_tilt]
z_positions: 47.5,165
             271,165
points:-43.50,82
        290,82
speed: 80
horizontal_move_z: 10
retries: 20
retry_tolerance: .0015

[screws_tilt_adjust]
screw1: 31.50, 177.50
screw1_name: Back left
screw2: 31.50, 6.50
screw2_name: Front left
screw3: 202, 6.50
screw3_name: Front right
screw4: 202, 177.50
screw4_name: Back right
screw_thread: CW-M4 #Ender 3s use CW-M4 change for your printer if needed
horizontal_move_z: 5

[temperature_fan PI]
pin: PA8
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0
cycle_time:0.01
off_below:0.1
sensor_type:  Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 70
target_temp: 20.0
control: watermark
#control: pid
#hardware_pwm: true
#pid_kp: 40.0
#pid_ki: 5.0
#pid_kd: 0.01

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: PG6
run_current: 0.900
hold_current: 0.5
stealthchop_threshold: 0

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: PG9
run_current: 1.000
hold_current: 0.8
stealthchop_threshold: 0

[tmc2209 stepper_z]
uart_pin: PC6
diag_pin: PG10
run_current: 0.900
stealthchop_threshold: 0

[tmc2209 stepper_z1]
uart_pin: PC7
diag_pin: PG11
run_current: 0.900
stealthchop_threshold: 0

[tmc2209 extruder]
uart_pin: EBBCan:PA15
run_current: 0.800
stealthchop_threshold: 0

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,
    
    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5
    
    #####################################################################
    #   Displays
    #####################################################################
    
    ##  mini12864 LCD Display
[display]
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

##  To control Neopixel RGB in mini12864 display
[neopixel btt_mini12864]
pin: EXP1_6
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.5
initial_BLUE: 0.9
color_order: RGB

##  Set RGB values on boot up for each Neopixel. 
##  Index 1 = display, Index 2 and 3 = Knob
#[delayed_gcode setdisplayneopixel]
#initial_duration: 1
#gcode:
   # SET_LED LED=btt_mini12864 RED=0 GREEN=0 BLUE=1 INDEX=1 TRANSMIT=0
    #SET_LED LED=btt_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
    #SET_LED LED=btt_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3 TRANSMIT=0

#[display]
#lcd_type: st7920
#cs_pin: EXP1_4
#sclk_pin: EXP1_5
#sid_pin: EXP1_3
#encoder_pins: ^EXP2_3, ^EXP2_5
#click_pin: ^!EXP1_2
#kill_pin: ^!EXP2_8

[output_pin beeper]
pin: EXP1_1


[neopixel sb_leds]
pin: EBBCan:PD3 #   The pin connected to the neopixel. This parameter must be provided.
chain_count: 3
#   The number of Neopixel chips that are "daisy chained" to the
#   provided pin. The default is 1 (which indicates only a single
#   Neopixel is connected to the pin).
color_order: GRBW
#   Set the pixel order required by the LED hardware. Options are GRB,
#   RGB, GRBW, or RGBW. The default is GRB.
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0
initial_WHITE: 0.1
#   Sets the initial LED color of the Neopixel. Each value should be
#   between 0.0 and 1.0. The WHITE option is only available on RGBW
#   LEDs. The default for each color is 0.#

# See the sample-lcd.cfg file for definitions of common LCD displays.

# A [probe] section can be defined instead with a pin: setting identical
# to the sensor_pin: for a bltouch
#[bltouch]
#sensor_pin: PB7
#control_pin: PB6
#z_offset: 0

#[neopixel my_neopixel]
#pin: PB0

[filament_switch_sensor switch_sensor]  
switch_pin: ^PG12 
pause_on_runout: False 
runout_gcode: 
 PAUSE  #  [pause_resume] is required in printer.cfg  
 M117 Filament switch runout 
insert_gcode: 
 M117 Filament switch inserted 
 
[filament_motion_sensor encoder_sensor]  
switch_pin: ^PG13 
detection_length: 2.88 # accuracy of motion sensor 2.88mm 
extruder: extruder  
pause_on_runout: False 
runout_gcode: 
 PAUSE  #  [pause_resume] is required in printer.cfg 
 M117 Filament encoder runout 
insert_gcode: 
 M117 Filament encoder inserted

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3259200.974,0.090000:3257962.121,0.130000:3256670.115,
#*# 	0.170000:3255409.831,0.210000:3254143.118,0.250000:3252858.185,
#*# 	0.290000:3251640.551,0.330000:3250423.940,0.370000:3249251.187,
#*# 	0.410000:3248055.696,0.450000:3246941.909,0.490000:3245761.646,
#*# 	0.530000:3244682.384,0.570000:3243617.665,0.610000:3242495.102,
#*# 	0.650000:3241432.573,0.690000:3240380.300,0.730000:3239332.096,
#*# 	0.770000:3238286.308,0.810000:3237305.859,0.850000:3236285.629,
#*# 	0.890000:3235310.251,0.930000:3234350.038,0.970000:3233387.100,
#*# 	1.010000:3232436.730,1.050000:3231481.517,1.090000:3230583.225,
#*# 	1.130000:3229689.951,1.170000:3228818.618,1.210000:3227911.659,
#*# 	1.250000:3227039.192,1.290000:3226195.140,1.330000:3225343.011,
#*# 	1.370000:3224477.220,1.410000:3223684.966,1.450000:3222885.239,
#*# 	1.490000:3222085.814,1.530000:3221304.563,1.570000:3220546.809,
#*# 	1.610000:3219811.775,1.650000:3219059.792,1.690000:3218347.787,
#*# 	1.730000:3217639.098,1.770000:3216934.791,1.810000:3216253.086,
#*# 	1.850000:3215550.528,1.890000:3214907.280,1.930000:3214243.480,
#*# 	1.970000:3213629.651,2.010000:3212977.845,2.050000:3212369.751,
#*# 	2.090000:3211773.276,2.130000:3211169.488,2.170000:3210561.883,
#*# 	2.210000:3209986.775,2.250000:3209397.343,2.290000:3208855.893,
#*# 	2.330000:3208292.509,2.370000:3207744.763,2.410000:3207240.549,
#*# 	2.450000:3206720.139,2.490000:3206202.688,2.530000:3205705.914,
#*# 	2.570000:3205220.801,2.610000:3204713.725,2.650000:3204205.606,
#*# 	2.690000:3203724.462,2.730000:3203268.701,2.770000:3202799.594,
#*# 	2.810000:3202349.820,2.850000:3201906.098,2.890000:3201486.658,
#*# 	2.930000:3201084.910,2.970000:3200674.810,3.010000:3200276.724,
#*# 	3.050000:3199884.312,3.090000:3199484.899,3.130000:3199119.466,
#*# 	3.170000:3198710.030,3.210000:3198357.630,3.250000:3198001.916,
#*# 	3.290000:3197619.794,3.330000:3197277.045,3.370000:3196921.302,
#*# 	3.410000:3196578.267,3.450000:3196262.546,3.490000:3195918.431,
#*# 	3.530000:3195594.683,3.570000:3195289.334,3.610000:3194961.829,
#*# 	3.650000:3194655.195,3.690000:3194336.026,3.730000:3194040.998,
#*# 	3.770000:3193736.984,3.810000:3193460.907,3.850000:3193163.177,
#*# 	3.890000:3192896.706,3.930000:3192664.502,3.970000:3192388.556,
#*# 	4.010000:3192111.617,4.050000:3191831.839
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 39.467262
#*# drift_calibration =
#*# 	3236603.861312, -432.395300, 3.215743
#*# 	3223623.159920, -247.917408, 1.620272
#*# 	3210833.157231, -32.892204, -0.282953
#*# 	3202639.624823, 51.259427, -0.962296
#*# 	3195045.263382, 157.067720, -1.933003
#*# 	3188879.467447, 242.827799, -2.727754
#*# 	3185687.482551, 235.737720, -2.610942
#*# 	3181003.792091, 314.842461, -3.363328
#*# 	3178349.249165, 333.306338, -3.524339
#*# drift_calibration_min_temp = 40.725074686316525
#*#
#*# [heater_bed]
#*# pid_kp = 69.093
#*# pid_ki = 0.952
#*# pid_kd = 1254.040
#*#
#*# [extruder]
#*# pid_kp = 29.54
#*# pid_ki = 13.132
#*# pid_kd = 16.621
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.033861, 0.025340, 0.039036, 0.030447, 0.034336, 0.023434, 0.010414, -0.020200, -0.054827
#*# 	  0.055395, 0.063408, 0.064736, 0.080082, 0.103586, 0.089962, 0.056809, 0.013952, -0.022886
#*# 	  0.065159, 0.088173, 0.062365, 0.083875, 0.105758, 0.086285, 0.052196, 0.013876, -0.032702
#*# 	  0.066700, 0.084093, 0.049132, 0.061339, 0.078046, 0.058714, 0.042729, 0.010136, -0.037312
#*# 	  0.037415, 0.051276, 0.041272, 0.052374, 0.066895, 0.038680, 0.037197, 0.041522, -0.023862
#*# 	  0.036867, 0.045952, 0.039638, 0.047895, 0.065667, 0.044637, 0.047079, 0.066120, -0.016149
#*# 	  0.017111, 0.035764, 0.033118, 0.041222, 0.050602, 0.028014, 0.032312, 0.025888, -0.035447
#*# 	  0.018943, 0.048231, 0.049302, 0.061205, 0.066010, 0.049950, 0.055826, 0.031055, -0.013048
#*# 	  -0.017894, 0.012851, 0.025871, 0.060159, 0.051075, 0.043694, 0.046030, 0.023130, -0.012516
#*# x_count = 9
#*# y_count = 9
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 220.0
#*# min_y = 10.0
#*# max_y = 192.0
